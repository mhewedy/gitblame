<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
      crossorigin="anonymous">

<script src="https://code.jquery.com/jquery-3.3.1.min.js" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
        crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" crossorigin="anonymous"></script>

<script>
    $(document).ready(function () {
        $.ajax({
            url: "/api"
        }).done(function (data) {
            displayAuthors(JSON.parse(data));
        });


    });

    function displayAuthors(authorsWithCommits) {

        let i = 0;
        for (let authorWithCommits of authorsWithCommits) {
            $("#container").append(authorsCollapseHtml(i, authorWithCommits.author, authorWithCommits.commits));
            i++;
        }
    }

    function authorsCollapseHtml(index, author, commits) {
        return '<div>' +
            '<button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse' + index + '" aria-expanded="false" >' +
            author.name + ' &lt;' + author.email + '&gt; ' + '(' + commits.length + ')' +
            '</button>' +
            '</div>' +
            '<div class="collapse" id="collapse' + index + '">' +
            '    <div class="card card-body">' +
            commitsHtml(commits) +
            '    </div>' +
            '</div>';
    }

    function commitsHtml(commits) {

        var response = '';

        let index = 0;
        for (commit of commits) {
            response += '<div>' +
                '<button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse-response'
                + index + '" aria-expanded="false" style="text-align: left;">' +
                commit.message +
                '</button>' +
                '</div>' +
                '<div class="collapse" id="collapse-response' + index + '">' +
                '    <div class="card card-body">' +
                '    </div>' +
                '</div>';
            index++;
        }

        return response;
    }

</script>

<div id="container">

</div>


